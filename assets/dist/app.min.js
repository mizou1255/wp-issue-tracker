import{_ as C,v as I,r as j,o as c,c as d,a as t,t as i,b as u,F as h,d as m,e as k,w as _,f as v,n as f,g as w,h as x,i as D,j as b,k as M,l as S}from"./plugin-vue_export-helper.min.js";import{N as B}from"./notyf.es.min.js";const E={name:"Dashboard",components:{VueEditor:I.exports.VueEditor},data(){const l=window.WPIT_Admin.WPIT_trans;return{loading:!1,loadingDetails:!1,skeletonRows:5,priorities:[],tickets:[],totalTicket:0,ticketsNew:0,ticketsWaiting:0,ticketsResolved:0,ticketsInProgress:0,ticketsClosed:0,newTicket:{title:"",content:"",priority:null,file:null},errors:{title:!1,content:!1,priority:!1},activeTicket:null,details:[],comments:[],newComment:"",showConfirmationModal:!1,ticketIdToUpdate:null,statusToConfirm:"",currentPage:1,perPage:10,perPageOptions:[5,10,20,50],totalPages:1,paginationButtons:[],statusOptions:[{value:"new",label:l.new,colorClass:"bg-blue-500 text-white"},{value:"in_progress",label:l.in_progress,colorClass:"bg-yellow-500 text-white"},{value:"waiting",label:l.waiting,colorClass:"bg-orange-500 text-white"},{value:"resolved",label:l.resolved,colorClass:"bg-green-500 text-white"},{value:"closed",label:l.closed,colorClass:"bg-gray-500 text-white"}],selectedStatusLabel:"",toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"],["html"]]}},mounted(){this.fetchPriorities(),this.fetchTickets(),this.initializeNotyf()},watch:{currentPage(){this.generatePaginationButtons()},totalPages(){this.generatePaginationButtons()}},computed:{translations(){return window.WPIT_Admin.WPIT_trans},statusLabel(){const l=this.statusOptions.find(e=>e.value===this.details.status);return l?l.label:this.details.status}},methods:{getStatusLabel(l){const e=this.statusOptions.find(a=>a.value===l);return e||{label:l,colorClass:"bg-gray-300 text-black"}},initializeNotyf(){this.notyf=new B({duration:3e3,position:{x:"right",y:"bottom"}})},fetchTickets(l=1){this.loading=!0,fetch(`/wp-json/wpissuetracker/v1/tickets?page=${l}&per_page=${this.perPage}`).then(e=>e.json()).then(e=>{this.tickets=e.tickets,this.totalTicket=e.total_tickets,this.ticketsNew=e.status_counts.new,this.ticketsWaiting=e.status_counts.waiting,this.ticketsInProgress=e.status_counts.in_progress,this.ticketsResolved=e.status_counts.resolved,this.ticketsClosed=e.status_counts.closed,this.totalPages=e.total_pages,this.currentPage=l,this.loading=!1}).catch(e=>{console.error("Erreur lors de la r\xE9cup\xE9ration des priorit\xE9s:",e),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des tickets: ${e}`),this.loading=!1})},perPageChanged(){this.fetchTickets(1)},generatePaginationButtons(){const l=[];if(this.totalPages<=10)for(let a=1;a<=this.totalPages;a++)l.push(a);else{let a=Math.max(1,this.currentPage-2),r=Math.min(this.totalPages,this.currentPage+2);this.currentPage<=3?r=10:this.currentPage>=this.totalPages-2&&(a=this.totalPages-10+1);for(let o=a;o<=r;o++)l.push(o)}this.paginationButtons=l},goToPage(l){l>=1&&l<=this.totalPages&&this.fetchTickets(l)},fetchPriorities(){fetch("/wp-json/wpissuetracker/v1/priorities").then(l=>l.json()).then(l=>{this.priorities=l}).catch(l=>{console.error("Erreur lors de la r\xE9cup\xE9ration des priorit\xE9s :",l),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des priorit\xE9s : ${l}`)})},handleFileUpload(l){this.newTicket.file=l.target.files[0]},openTicketModal(){document.getElementById("ticket-modal").showModal()},closeTicketModal(){document.getElementById("ticket-modal").close()},confirmUpdateStatus(l,e){this.ticketIdToUpdate=l,this.statusToConfirm=e;const a=this.statusOptions.find(r=>r.value===e);this.selectedStatusLabel=a?a.label:"",document.getElementById("confirmation-modal").showModal()},confirmStatusChange(){this.updateTicketStatus(this.ticketIdToUpdate,this.statusToConfirm),this.closeConfirmationModal()},closeConfirmationModal(){document.getElementById("confirmation-modal").close(),this.ticketIdToUpdate=null,this.statusToConfirm=""},updateTicketStatus(l,e){const a=new FormData;a.append("status",e),fetch(`/wp-json/wpissuetracker/v1/update-ticket-status/${l}`,{method:"POST",headers:{"X-WP-Nonce":WPIT_Admin.nonce},body:a}).then(r=>r.json()).then(r=>{r.success?(this.notyf.success(this.translations.ticket_updated),this.fetchTickets()):(console.error("Erreur lors de la mise \xE0 jour du statut:",r.message),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des tickets: ${r.message}`))}).catch(r=>{console.error("Erreur lors de la mise \xE0 jour du statut:",r),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des tickets: ${r}`)})},validateFields(){return this.errors.title=!this.newTicket.title,this.errors.content=!this.newTicket.content,this.errors.priority=!this.newTicket.priority,!this.errors.title&&!this.errors.content&&!this.errors.priority},createTicket(){if(!this.validateFields()){this.notyf.error(this.translations.validation_error);return}const l=new FormData;l.append("title",this.newTicket.title),l.append("content",this.newTicket.content),l.append("priority",this.newTicket.priority),this.newTicket.file&&l.append("file",this.newTicket.file),fetch("/wp-json/wpissuetracker/v1/create-ticket",{method:"POST",headers:{"X-WP-Nonce":WPIT_Admin.nonce},body:l}).then(e=>e.json()).then(e=>{e.success&&(this.newTicket={title:"",content:"",priority:null,file:null},this.errors={title:!1,content:!1,priority:!1},this.tickets.unshift(e.ticket),this.closeTicketModal(),this.notyf.success(this.translations.ticket_created_success),this.fetchTickets())})},viewTicketDetails(l){this.activeTicket=l,this.fetchDetails(l.id),this.fetchComments(l.id),document.getElementById("ticket-detail").showModal()},closeTicketDetail(){document.getElementById("ticket-detail").close(),this.activeTicket=null,this.comments=[]},fetchDetails(l){this.loadingDetails=!0,fetch(`/wp-json/wpissuetracker/v1/get-ticket-details/${l}`).then(e=>e.json()).then(e=>{this.details=e||[],this.loadingDetails=!1}).catch(e=>{console.error("Erreur lors de la r\xE9cup\xE9ration des commentaires:",e),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des commentaires: ${e}`),this.loadingDetails=!1})},fetchComments(l){this.loadingDetails=!0,fetch(`/wp-json/wpissuetracker/v1/get-ticket-comments/${l}`).then(e=>e.json()).then(e=>{this.comments=e.comments||[],this.loadingDetails=!1}).catch(e=>{console.error("Erreur lors de la r\xE9cup\xE9ration des commentaires:",e),this.notyf.error(`Erreur lors de la r\xE9cup\xE9ration des commentaires: ${e}`),this.loadingDetails=!1})},submitComment(){const l=new FormData;l.append("ticket_id",this.activeTicket.id),l.append("comment",this.newComment),fetch("/wp-json/wpissuetracker/v1/add-comment",{method:"POST",headers:{"X-WP-Nonce":WPIT_Admin.nonce},body:l}).then(e=>e.json()).then(e=>{e.success&&(this.comments.unshift(e.comment),this.newComment="")})}}},U={class:"container p-4 grid grid-cols-12 gap-4"},V={class:"col-span-12 lg:col-span-3 bg-white shadow-md p-4 rounded-lg"},N={class:"text-xl font-bold mb-4"},O={class:"space-y-3"},W={class:"stat"},F={class:"stat-title"},L={class:"stat-value"},A={class:"stat"},R={class:"stat-title"},z={class:"stat-value"},X={class:"stat"},H={class:"stat-title"},K={class:"stat-value"},q={class:"stat"},J={class:"stat-title"},Y={class:"stat-value"},G={class:"stat"},Q={class:"stat-title"},Z={class:"stat-value"},$={class:"stat"},tt={class:"stat-title"},et={class:"stat-value"},st={class:"col-span-12 lg:col-span-9 bg-white shadow-md p-4 rounded-lg"},it={class:"flex justify-between items-center mb-4"},lt={class:"text-xl font-bold"},nt={key:0},ot={key:1,class:"w-full"},at={class:"flex items-center"},rt={for:"perPageSelect",class:"mr-2"},ct=["value"],dt={class:"table w-full"},ut=["onClick"],ht={class:"join flex justify-center mt-6 pt-4"},mt=["onClick"],_t={id:"confirmation-modal",class:"modal"},ft={class:"modal-box"},pt={class:"text-lg font-bold mb-4"},gt={class:"modal-action flex justify-between"},vt={id:"ticket-modal",class:"modal"},bt={class:"modal-box"},kt={class:"text-lg font-bold mb-4"},wt={class:"wpit-label label",for:"title"},xt={class:"wpit-label label",for:"content"},yt={class:"wpit-label label",for:"priority"},Tt=["value"],Pt={class:"modal-action"},Ct={type:"submit",class:"btn btn-primary w-full rounded-full"},It={id:"ticket-detail",class:"modal"},jt={class:"modal-box w-full max-w-2xl h-auto"},Dt={key:0},Mt={key:0},St={key:1},Bt={class:"text-lg font-bold mb-4"},Et={class:"flex justify-between"},Ut={class:"mb-1"},Vt=["innerHTML"],Nt={class:"mb-1"},Ot={class:"mb-1"},Wt={class:"mb-1"},Ft={class:"mb-1"},Lt={key:0,class:"ms-4 min-w-60 max-w-64"},At=["href"],Rt=["src"],zt={class:"wpit-group form-control mb-4"},Xt={class:"wpit-label label"},Ht={value:"new"},Kt={value:"waiting"},qt={value:"in_progress"},Jt={value:"resolved"},Yt={value:"closed"},Gt={key:1},Qt={key:2,class:"mt-4"},Zt={class:"text-lg font-bold"},$t=["placeholder"],te={class:"modal-action mt-2"},ee=["disabled"],se={class:"mt-2 space-y-2"},ie={class:"text-sm text-gray-500"};function le(l,e,a,r,o,s){const T=j("vue-editor");return c(),d("div",U,[t("div",V,[t("h3",N,i(s.translations.statistics),1),t("div",O,[t("div",W,[t("div",F,i(s.translations.total_tickets),1),t("div",L,i(o.totalTicket),1)]),t("div",A,[t("div",R,i(s.translations.new),1),t("div",z,i(o.ticketsNew),1)]),t("div",X,[t("div",H,i(s.translations.waiting),1),t("div",K,i(o.ticketsWaiting),1)]),t("div",q,[t("div",J,i(s.translations.in_progress),1),t("div",Y,i(o.ticketsInProgress),1)]),t("div",G,[t("div",Q,i(s.translations.resolved),1),t("div",Z,i(o.ticketsResolved),1)]),t("div",$,[t("div",tt,i(s.translations.closed),1),t("div",et,i(o.ticketsClosed),1)])])]),t("div",st,[t("div",it,[t("h3",lt,i(s.translations.tickets_list),1),t("button",{class:"btn btn-primary rounded-full",onClick:e[0]||(e[0]=(...n)=>s.openTicketModal&&s.openTicketModal(...n))},[e[16]||(e[16]=t("i",{class:"fas fa-plus-circle mr-2"},null,-1)),u(" "+i(s.translations.add_new_ticket),1)])]),o.loading?(c(),d("div",nt,[(c(!0),d(h,null,m(o.skeletonRows,n=>(c(),d("div",{key:n,class:"flex flex-col gap-4 w-full"},e[17]||(e[17]=[k('<div class="flex gap-4 items-center"><div class="skeleton w-16 h-16 rounded-full shrink-0"></div><div class="flex flex-col gap-4 w-full"><div class="skeleton h-4 w-full"></div><div class="skeleton h-4 w-full"></div></div></div><div class="divider my-1"></div>',2)])))),128))])):(c(),d("div",ot,[t("div",at,[t("label",rt,i(s.translations.show_per_page),1),_(t("select",{id:"perPageSelect","onUpdate:modelValue":e[1]||(e[1]=n=>o.perPage=n),onChange:e[2]||(e[2]=(...n)=>s.perPageChanged&&s.perPageChanged(...n)),class:"select select-bordered"},[(c(!0),d(h,null,m(o.perPageOptions,n=>(c(),d("option",{key:n,value:n},i(n),9,ct))),128))],544),[[v,o.perPage]])]),t("table",dt,[t("thead",null,[t("tr",null,[t("th",null,i(s.translations.title),1),t("th",null,i(s.translations.user),1),t("th",null,i(s.translations.priority),1),t("th",null,i(s.translations.status),1),t("th",null,i(s.translations.actions),1)])]),t("tbody",null,[(c(!0),d(h,null,m(o.tickets,n=>(c(),d("tr",{key:n.id},[t("td",null,i(n.title),1),t("td",null,i(n.user_display_name),1),t("td",null,i(n.priority_name),1),t("td",null,[t("span",{class:f(["px-2 py-1 rounded-full text-xs font-semibold",s.getStatusLabel(n.status).colorClass])},i(s.getStatusLabel(n.status).label),3)]),t("td",null,[t("button",{onClick:P=>s.viewTicketDetails(n),class:"btn btn-sm btn-outline"},i(s.translations.details),9,ut)])]))),128))])]),t("div",ht,[(c(!0),d(h,null,m(o.paginationButtons,n=>(c(),d("button",{key:n,class:f(["join-item btn",{"btn-disabled":n==="..."||n===o.currentPage}]),onClick:P=>s.goToPage(n)},i(n),11,mt))),128))])]))]),t("dialog",_t,[t("div",ft,[t("h3",pt,i(s.translations.confirm_status_change),1),t("p",null,[u(i(s.translations.description_status_change)+' "',1),t("strong",null,i(o.selectedStatusLabel),1),e[18]||(e[18]=u('" ? '))]),t("div",gt,[t("button",{onClick:e[3]||(e[3]=(...n)=>s.closeConfirmationModal&&s.closeConfirmationModal(...n)),class:"btn btn-secondary"},i(s.translations.cancel),1),t("button",{onClick:e[4]||(e[4]=(...n)=>s.confirmStatusChange&&s.confirmStatusChange(...n)),class:"btn btn-primary"},i(s.translations.confirm),1)])])]),t("dialog",vt,[t("div",bt,[t("form",{onSubmit:e[10]||(e[10]=w((...n)=>s.createTicket&&s.createTicket(...n),["prevent"]))},[t("button",{onClick:e[5]||(e[5]=(...n)=>s.closeTicketModal&&s.closeTicketModal(...n)),class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"}," \u2715 "),t("h3",kt,i(s.translations.add_new_ticket),1),t("div",{class:f([["wpit-group",{"input-error":o.errors.title}],"form-control mb-4"])},[t("label",wt,i(s.translations.title),1),_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>o.newTicket.title=n),type:"text",id:"title",class:"wpit-input input input-bordered"},null,512),[[x,o.newTicket.title]])],2),t("div",{class:f([["form-control",{"input-error":o.errors.content}],"mb-4"])},[t("label",xt,i(s.translations.description),1),t("div",null,[D(T,{modelValue:o.newTicket.content,"onUpdate:modelValue":e[7]||(e[7]=n=>o.newTicket.content=n),editorToolbar:o.toolbarOptions},null,8,["modelValue","editorToolbar"])])],2),t("div",{class:f([["wpit-group",{"input-error":o.errors.priority}],"form-control mb-4"])},[t("label",yt,i(s.translations.priority),1),_(t("select",{"onUpdate:modelValue":e[8]||(e[8]=n=>o.newTicket.priority=n),id:"priority",class:"wpit-input input input-bordered"},[(c(!0),d(h,null,m(o.priorities,n=>(c(),d("option",{key:n.id,value:n.id},i(n.name),9,Tt))),128))],512),[[v,o.newTicket.priority]])],2),t("input",{type:"file",onChange:e[9]||(e[9]=(...n)=>s.handleFileUpload&&s.handleFileUpload(...n)),class:"file-input w-full mb-4"},null,32),t("div",Pt,[t("button",Ct,i(s.translations.add),1)])],32)])]),t("dialog",It,[t("div",jt,[t("button",{onClick:e[11]||(e[11]=(...n)=>s.closeTicketDetail&&s.closeTicketDetail(...n)),class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"}," \u2715 "),o.activeTicket?(c(),d("div",Dt,[o.loadingDetails?(c(),d("div",Mt,e[19]||(e[19]=[k('<div class="flex w-full flex-col gap-4"><div class="flex items-center gap-4"><div class="flex flex-col gap-4"><div class="skeleton h-4 w-28"></div><div class="skeleton h-4 w-32"></div><div class="skeleton h-4 w-52"></div></div><div class="skeleton h-32 w-52"></div></div></div>',1)]))):(c(),d("div",St,[t("h3",Bt,i(o.details.title),1),t("div",Et,[t("div",null,[t("div",Ut,[t("strong",null,i(s.translations.description)+" :",1),t("div",{innerHTML:o.details.description},null,8,Vt)]),t("div",Nt,[t("strong",null,i(s.translations.priority)+" :",1),u(" "+i(o.details.priority_name),1)]),t("div",Ot,[t("strong",null,i(s.translations.status)+" :",1),u(" "+i(s.statusLabel),1)]),t("div",Wt,[t("strong",null,i(s.translations.created_by)+" :",1),u(" "+i(o.details.author),1)]),t("div",Ft,[t("strong",null,i(s.translations.creation_date)+" :",1),u(" "+i(o.details.date),1)])]),o.details.attachment_url?(c(),d("div",Lt,[t("a",{href:o.details.attachment_url,target:"_blank"},[t("img",{src:o.details.attachment_url,width:"100%"},null,8,Rt)],8,At)])):b("",!0)])]))])):b("",!0),e[21]||(e[21]=t("div",{class:"divider"},null,-1)),t("div",zt,[t("label",Xt,i(s.translations.change_status)+" :",1),_(t("select",{"onUpdate:modelValue":e[12]||(e[12]=n=>o.details.status=n),onChange:e[13]||(e[13]=n=>s.confirmUpdateStatus(o.details.id,o.details.status)),class:"wpit-input input input-bordered"},[t("option",Ht,i(s.translations.new),1),t("option",Kt,i(s.translations.waiting),1),t("option",qt,i(s.translations.in_progress),1),t("option",Jt,i(s.translations.resolved),1),t("option",Yt,i(s.translations.closed),1)],544),[[v,o.details.status]])]),e[22]||(e[22]=t("div",{class:"divider"},null,-1)),o.loadingDetails?(c(),d("div",Gt,e[20]||(e[20]=[t("div",{class:"flex w-full flex-col gap-4"},[t("div",{class:"skeleton h-4 w-56"}),t("div",{class:"skeleton h-4 w-72"}),t("div",{class:"skeleton h-4 w-full"})],-1)]))):(c(),d("div",Qt,[t("h4",Zt,i(s.translations.comments),1),o.activeTicket?(c(),d("form",{key:0,onSubmit:e[15]||(e[15]=w((...n)=>s.submitComment&&s.submitComment(...n),["prevent"])),class:"mt-4"},[_(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=n=>o.newComment=n),class:"textarea textarea-bordered w-full",placeholder:s.translations.add_comment},null,8,$t),[[x,o.newComment]]),t("div",te,[t("button",{type:"submit",class:"btn btn-primary",disabled:!o.newComment},i(s.translations.send),9,ee)])],32)):b("",!0),t("ul",se,[(c(!0),d(h,null,m(o.comments,n=>(c(),d("li",{key:n.id,class:"p-4 bg-gray-100 rounded-md"},[t("p",null,i(n.comment),1),t("p",ie,i(s.translations.posted_by)+" "+i(n.author)+" "+i(s.translations.on)+" "+i(n.date),1)]))),128))])]))])])])}var ne=C(E,[["render",le]]);function p(l,e){const a=g();return p=function(r,o){return r=r-440,a[r]},p(l,e)}const y=p;(function(l,e){const a=p,r=l();for(;[];)try{if(-parseInt(a(449))/1+parseInt(a(448))/2*(parseInt(a(450))/3)+-parseInt(a(445))/4+parseInt(a(440))/5+parseInt(a(441))/6*(-parseInt(a(444))/7)+-parseInt(a(446))/8+parseInt(a(443))/9===e)break;r.push(r.shift())}catch{r.push(r.shift())}})(g,939365);function g(){const l=["60xhKbNT","mount","30652794uFMceo","45038eJgjXL","5148996CnerwP","3709968BiAYnK","#wpissuetracker-admin-app","2tzImBq","1607854RBhvqH","2256789oFvwKb","1022125xrToMN"];return g=function(){return l},g()}const oe=M({render:()=>S(ne)});oe[y(442)](y(447));
